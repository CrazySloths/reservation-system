# ðŸ”„ TWO-WAY INTEGRATION TESTING GUIDE

## ðŸ“‹ Overview

This document explains how to test the **complete two-way integration** between Public Facilities and Energy Efficiency systems using local databases before deploying with real APIs.

## âš ï¸ IMPORTANT: Architecture Rules

**NO HARDCODED DATA** - Following project architecture:
- âœ… All facility names pulled from `facilities` table
- âœ… All supplier names pulled from `suppliers` table  
- âœ… All prices pulled from `supplier_products` table
- âœ… All tracking IDs auto-generated by system
- âœ… All transparency data calculated dynamically
- âŒ NO hardcoded facility names, prices, or supplier names

**Examples in this document are for understanding the flow only.**  
Actual implementation pulls ALL data from database tables.

---

## ðŸŽ¯ What We're Testing

### **FROM THEM â†’ TO US (Inbound)**
âœ… Energy Efficiency sends facility requests  
âœ… We receive and display in Admin UI  
âœ… Admin reviews and coordinates  

### **FROM US â†’ TO THEM (Outbound)**
âœ… Admin assigns facility and approves funds  
âœ… We send confirmation back  
âœ… They receive and display transparency data  

---

## ðŸ“¦ What I've Created

### **1. Tables Added to THEIR Database (`ener_nova_capri`)**

I created **3 new tables** that you need to add to their database:

```
database/migrations_energy_efficiency/
â””â”€â”€ add_facility_response_tables.sql
```

**Tables:**
1. `facility_booking_confirmations` - Main confirmation response
2. `facility_confirmation_photos` - Event photos and receipts
3. `facility_confirmation_receipts` - Itemized spending details

**What to do:**
1. Open phpMyAdmin
2. Select `ener_nova_capri` database
3. Run the SQL file: `database/migrations_energy_efficiency/add_facility_response_tables.sql`
4. This adds the tables we need to write our responses to

### **2. Tables in OUR Database (`lgu1_facilities`)**

Already created via migrations:
1. `government_program_bookings` - Stores requests from them
2. `suppliers` - Supplier database
3. `supplier_products` - Product catalog
4. `liquidation_items` - Spending details
5. `citizen_program_registrations` - Attendee tracking

---

## ðŸ§ª TESTING PHASE 1: Setup Databases

### **Step 1: Import Their Database**

```bash
# In phpMyAdmin:
1. Create database: ener_nova_capri
2. Import: database/ener_nova_capri.sql
3. Run: database/migrations_energy_efficiency/add_facility_response_tables.sql
```

### **Step 2: Setup Our Database Connection**

Add to `.env`:
```env
# Energy Efficiency Database (for testing)
EE_DB_HOST=127.0.0.1
EE_DB_PORT=3306
EE_DB_DATABASE=ener_nova_capri
EE_DB_USERNAME=root
EE_DB_PASSWORD=
```

Add to `config/database.php`:
```php
'connections' => [
    // ... existing connections ...
    
    'energy_efficiency' => [
        'driver' => 'mysql',
        'host' => env('EE_DB_HOST', '127.0.0.1'),
        'port' => env('EE_DB_PORT', '3306'),
        'database' => env('EE_DB_DATABASE', 'ener_nova_capri'),
        'username' => env('EE_DB_USERNAME', 'root'),
        'password' => env('EE_DB_PASSWORD', ''),
        'charset' => 'utf8mb4',
        'collation' => 'utf8mb4_unicode_ci',
        'prefix' => '',
        'strict' => true,
        'engine' => null,
    ],
],
```

### **Step 3: Run Our Migrations**

```bash
cd c:\laragon\www\local-government-unit-1-ph.com
php artisan migrate
```

---

## ðŸ§ª TESTING PHASE 2: Inbound (Their Request â†’ Our System)

### **Step 1: They Insert Request (Backdoor)**

In phpMyAdmin, `ener_nova_capri` database:

```sql
-- They already have this seminar (ID = 28)
-- Just verify it exists:
SELECT * FROM seminars WHERE seminar_id = 28;
```

This simulates them sending us a facility request.

### **Step 2: We Fetch Their Request**

Visit our admin dashboard:
```
http://localhost/local-government-unit-1-ph.com/admin/government-programs
```

**Expected Result:**
- Shows "Energy Conservation Seminar" from their database
- Status: "Pending Review"
- Organizer: Christian Arnaldo Cando
- Requested Date: January 23, 2026
- Requested Funds: â‚±5,000

### **Step 3: Admin Reviews Request**

Click "View Details" and see:
- âœ… Event details from their `seminars` table
- âœ… Organizer info from their `users` table
- âœ… Requested location, attendees, funds

---

## ðŸ§ª TESTING PHASE 3: Coordination Workflow

### **Step 1: Admin Calls Organizer (External)**

Admin sees organizer contact:
```
Phone: 9085919898
Email: piyasigno@gmail.com
```

Admin calls on mobile phone, discusses fund breakdown.

### **Step 2: Admin Records Call Notes**

In the system, admin enters:
```
Call Log:
"Called Jan 10, 10:00 AM
Agreed fund breakdown:
- Food: â‚±2,500 (Jollibee C1 x150)
- Materials: â‚±2,000 (handbooks, pens)
- Transportation: â‚±300
- Misc: â‚±200"
```

### **Step 3: Admin Coordinates Speaker**

Admin enters speaker details:
```
Speaker 1: Dr. Juan Dela Cruz (DOE)
Topic: Home Energy Conservation
Duration: 45 minutes

Speaker 2: Eng. Maria Santos (Meralco)
Topic: Understanding Electric Bills
Duration: 30 minutes
```

### **Step 4: Admin Assigns Facility**

Admin selects from dropdown:
```
Facility: Barangay 188 Multi-Purpose Hall
Capacity: 200 seats
Equipment: Projector, Sound System, AC
Fee: â‚±3,000 â†’ WAIVED (â‚±0.00)
```

---

## ðŸ§ª TESTING PHASE 4: Outbound (Our Response â†’ Their System)

### **Step 5: Admin Confirms & Sends Back**

Admin clicks **"Send Confirmation to Energy Efficiency"**

**What happens:**
1. System creates record in OUR database: `government_program_bookings`
2. System WRITES to THEIR database: `ener_nova_capri.facility_booking_confirmations`

### **Step 6: Verify Data in Their Database**

In phpMyAdmin, `ener_nova_capri` database:

```sql
SELECT * FROM facility_booking_confirmations WHERE seminar_id = 28;
```

**Expected Result:**
```
confirmation_id: 1
seminar_id: 28
public_facilities_tracking_id: GPR-2026-001
request_status: confirmed

assigned_facility_name: Barangay 188 Multi-Purpose Hall
assigned_facility_address: Camarin Road, Barangay 188, Caloocan City
assigned_facility_capacity: 200

confirmed_date: 2026-01-23
confirmed_start_time: 20:00:00
confirmed_end_time: 22:00:00

confirmed_speakers: [JSON with speaker details]

approved_amount: 5000.00
pre_event_budget_breakdown: [JSON with itemized budget]

transparency_report_url: http://localhost/.../transparency/GPR-2026-001
```

### **Step 7: They Display Our Response**

Energy Efficiency system can now query and display:

```sql
-- Get confirmation details
SELECT 
    s.seminar_title,
    fbc.assigned_facility_name,
    fbc.confirmed_date,
    fbc.confirmed_start_time,
    fbc.approved_amount,
    fbc.transparency_report_url
FROM facility_booking_confirmations fbc
JOIN seminars s ON fbc.seminar_id = s.seminar_id
WHERE fbc.seminar_id = 28;
```

---

## ðŸ§ª TESTING PHASE 5: Transparency Report

### **Step 8: Citizens View Transparency**

Visit transparency URL:
```
http://localhost/local-government-unit-1-ph.com/public/transparency/GPR-2026-001
```

**Expected Display:**

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GOVERNMENT PROGRAM TRANSPARENCY REPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Event: Energy Conservation Seminar
Date: January 23, 2026
Facility: Barangay 188 Multi-Purpose Hall (FREE)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PRE-EVENT BUDGET BREAKDOWN (Approved: â‚±5,000.00)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ðŸ± Food & Refreshments: â‚±2,500.00
   â””â”€ 150 Jollibee Chickenjoy C1 meals @ â‚±89/meal
      Supplier: Jollibee Caloocan Branch
      
ðŸ“š Training Materials: â‚±2,000.00
   â”œâ”€ 150 handbooks @ â‚±10 = â‚±1,500
   â”œâ”€ 150 ballpens @ â‚±3 = â‚±450
   â””â”€ 150 certificates @ â‚±0.35 = â‚±50
      Supplier: PrintHub Caloocan
      
ðŸš– Speaker Transportation: â‚±300.00
   â””â”€ DOE Speaker round-trip from Manila
   
ðŸ“‹ Miscellaneous: â‚±200.00
   â””â”€ Signage, name tags, markers

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FREE FOR CITIZENS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Venue (Waived: â‚±3,000)
âœ… Projector & Sound System
âœ… Air Conditioning
âœ… Free snacks (Jollibee meal)
âœ… Free handbooks
âœ… Free certificate
âœ… NO ADMISSION FEE

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Citizens can verify these prices:
â€¢ Visit Jollibee: Check if C1 is really â‚±89
â€¢ Visit print shops: Check if prices are reasonable
â€¢ Report if you find discrepancies
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

---

## ðŸ§ª TESTING PHASE 6: Post-Event Liquidation

### **Step 9: After Event, Admin Updates Actual Spending**

Admin enters actual data:
```
Actual Attendees: 142 (expected 150)

ACTUAL SPENDING:
- Food: â‚±2,418 (142 meals @ â‚±89)
  Receipt: OR#123456789
  
- Materials: â‚±2,000 (bought 150 sets)
  Receipt: OR#987654321
  
- Transportation: â‚±280
- Misc: â‚±182

TOTAL: â‚±4,880
SAVINGS: â‚±120 (returned to city budget)
```

Uploads:
- Jollibee receipt photo
- Print shop receipt photo
- Event photos

### **Step 10: System Writes Liquidation to Their DB**

In `ener_nova_capri.facility_booking_confirmations`:

```sql
UPDATE facility_booking_confirmations
SET 
    post_event_liquidation = '{...actual spending JSON...}',
    liquidation_submitted_at = NOW()
WHERE seminar_id = 28;
```

### **Step 11: Citizens Verify Prices**

Transparency page now shows:

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
POST-EVENT ACTUAL SPENDING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… COMPLETED: January 23, 2026
ðŸ‘¥ Actual Attendees: 142 (8 no-shows)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ACTUAL BREAKDOWN:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ðŸ± Food: â‚±2,418.00
   â”œâ”€ Item: Jollibee Chickenjoy C1
   â”œâ”€ Quantity: 142 meals
   â”œâ”€ Price: â‚±89/meal
   â”œâ”€ Receipt: OR#123456789 [View Image]
   â””â”€ Supplier: Jollibee Caloocan Branch
   
   âœ… Price verified by 23 citizens
   ðŸ’¬ "Confirmed, C1 is â‚±89 in Jollibee menu"

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
COMPARISON:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Planned: â‚±5,000.00
Actual:  â‚±4,880.00
Savings: â‚±120.00 âœ… Returned to city budget

Transparency Score: â­â­â­â­â­ (5/5)
- All receipts uploaded âœ…
- Prices verified by citizens âœ…
- Savings returned âœ…
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

---

## ðŸ“Š DATA FLOW DIAGRAM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ENERGY EFFICIENCY SYSTEM                   â”‚
â”‚  (ener_nova_capri database)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ 1. INSERT seminar
                    â”‚    (facility request)
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PUBLIC FACILITIES - ADMIN UI               â”‚
â”‚  /admin/government-programs                 â”‚
â”‚                                             â”‚
â”‚  â†’ Fetches their seminars.* table           â”‚
â”‚  â†’ Fetches their users.* table              â”‚
â”‚  â†’ Shows "New Request"                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ 2. Admin reviews
                    â”‚ 3. Admin calls organizer
                    â”‚ 4. Admin assigns facility
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OUR DATABASE                               â”‚
â”‚  (lgu1_facilities)                          â”‚
â”‚                                             â”‚
â”‚  â†’ government_program_bookings              â”‚
â”‚  â†’ liquidation_items                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ 5. INSERT confirmation
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACK TO THEIR DATABASE                     â”‚
â”‚  (ener_nova_capri)                          â”‚
â”‚                                             â”‚
â”‚  â†’ facility_booking_confirmations           â”‚
â”‚  â†’ facility_confirmation_photos             â”‚
â”‚  â†’ facility_confirmation_receipts           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ 6. They query and display
                    â†“
        Energy Efficiency displays:
        - Assigned facility
        - Speakers & topics
        - Fund transparency
        - Citizens view report
```

---

## âœ… TESTING CHECKLIST

### **Phase 1: Setup**
- [ ] Import `ener_nova_capri.sql` to phpMyAdmin
- [ ] Run `add_facility_response_tables.sql` in their DB
- [ ] Add database connection to `.env`
- [ ] Add connection config to `config/database.php`
- [ ] Run our migrations: `php artisan migrate`

### **Phase 2: Inbound (Them â†’ Us)**
- [ ] Verify seminar exists in their `seminars` table
- [ ] Visit `/admin/government-programs`
- [ ] See their seminar in our UI
- [ ] View organizer contact details
- [ ] See requested funds and details

### **Phase 3: Coordination**
- [ ] Admin records call log notes
- [ ] Admin enters speaker details
- [ ] Admin assigns facility
- [ ] Status changes to "Coordinating"

### **Phase 4: Outbound (Us â†’ Them)**
- [ ] Admin clicks "Send Confirmation"
- [ ] Check our DB: `government_program_bookings` has record
- [ ] Check their DB: `facility_booking_confirmations` has record
- [ ] Verify all JSON fields populated correctly

### **Phase 5: Transparency**
- [ ] Visit transparency URL
- [ ] See pre-event budget breakdown
- [ ] See itemized list with suppliers
- [ ] See "FREE for citizens" section

### **Phase 6: Post-Event**
- [ ] Admin enters actual attendees
- [ ] Admin uploads receipts
- [ ] Admin enters actual spending
- [ ] System updates their DB with liquidation
- [ ] Transparency page shows comparison (planned vs actual)

---

## ðŸš€ PRODUCTION MIGRATION

Once testing is successful, **production changes:**

### **INBOUND: API Instead of Database Read**

**Testing (current):**
```php
// Read from their database
$seminars = DB::connection('energy_efficiency')
    ->table('seminars')
    ->where('is_archived', 0)
    ->get();
```

**Production (future):**
```php
// They POST to our API
POST /api/facilities/government-program/request
{
  "seminar_id": 28,
  "organizer_name": "...",
  "event_details": {...},
  "fund_request": {...}
}
```

### **OUTBOUND: API Instead of Database Write**

**Testing (current):**
```php
// Write to their database
DB::connection('energy_efficiency')
    ->table('facility_booking_confirmations')
    ->insert([...]);
```

**Production (future):**
```php
// POST to their webhook
POST https://energyefficiency.caloocan.gov.ph/api/facility-booking/confirmation
{
  "seminar_id": 28,
  "assigned_facility": {...},
  "confirmed_speakers": [...],
  "transparency_url": "..."
}
```

---

## ðŸ“ TELL ENERGY EFFICIENCY TEAM

Share this with them:

> "Hi Energy Efficiency team,
> 
> For our integration testing, we've created tables in your database 
> to receive facility booking confirmations. Please:
> 
> 1. Run this SQL file in your test database:
>    `database/migrations_energy_efficiency/add_facility_response_tables.sql`
> 
> 2. This creates 3 tables:
>    - facility_booking_confirmations
>    - facility_confirmation_photos
>    - facility_confirmation_receipts
> 
> 3. After testing successfully, we'll switch to API communication
>    using the exact same data structure.
> 
> 4. You can query these tables to display our confirmations in your system."

---

## ðŸŽ‰ DONE!

You now have a complete two-way testing environment where:
- âœ… You can test receiving their requests
- âœ… You can test sending confirmations back
- âœ… Everything uses local databases
- âœ… Same structure will work with APIs in production
- âœ… Complete transparency for citizens

